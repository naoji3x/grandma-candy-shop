# テストドキュメントスコープ定義ルール

Test Document Scope Rules

## 1. 目的

本ルールは、テストに関する各ドキュメント（戦略・観点・仕様・設計など）について、

- **どのドキュメントに**
- **どこまで記述するか**
- **何を書いてはいけないか**

を明確にし、
**重複・抜け漏れ・責務の混乱を防ぐ**ことを目的とする。

## 2. 基本原則

### 2.1. 責務分離の原則

- 上位は **方針・基準・網羅性**
- 下位は **具体化・展開・実行可能性**

とする。

### 2.2. 非重複の原則

- 同一内容を複数成果物に重複記載しない
- 重複が必要な場合は **参照（IDリンク）で表現**する

### 2.3. 「書かない」ことも仕様である

- 対象外・除外理由・委譲先を明示する
- 「ここには書かない」は下流工程の迷いを減らす

## 3. 文書責務

本章 3.1〜3.4 は本ルールのまとめであり、3.5 以降は理解補助のための参考情報とする。

### 3.1. 共通（テスト全体）

1. **テスト戦略・方針** (TSP: Test Strategy / Policy; `tsp-overview`)
   - テスト全体の目的／基本方針／役割分担（レベル別の責務境界）を定義する
   - 品質ゲート（入口条件・出口条件）を定義する
   - 環境・データ・自動化・不具合運用など、テスト運用の前提を定義する
     ※ 個別の観点・条件・ケースは記載しない

2. **テスト観点・条件** (TPC: Test Perspectives & Conditions; `tpc-<term>`)
   - 観点（What）と条件（When/State）を網羅し、上位仕様へトレースする
   - まだテストレベル（単体／結合／総合／受入）には分配しない
     ※ ケース・具体値は定義しない

### 3.2. テストレベル別（共通パターン）

以下の4種を **全テストレベル（単体／内部結合／外部結合／総合／受入）で共通**とする。

1. **仕様 全体構成** (`<level>s-index`)
   - TPC を当該レベルの責務として解釈し、分配方針（境界・対象単位・合格基準）を固定する
   - 個別仕様（`<level>s-<term>`）への入口（ナビゲーション）となる
     ※ ケースは書かない

2. **仕様 個別仕様** (`<level>s-<term>`)
   - 対象単位ごとに、保証範囲（観点）／代表条件（状態レベル）／合格基準を定義する
     ※ ケース・具体値は設計へ委譲

3. **設計 全体構成** (`<level>d-index`)
   - 共通のケース構成ルール（観点×条件→ケース）と、準備・実行・証跡の標準を定義する

4. **設計 個別設計** (`<level>d-<term>`)
   - 観点（TP）×条件（TC）を組み合わせてテストケースを具体化し、実行可能粒度まで落とす

※注記:

- `<level>`はテストレベル略号（ut/it/et/st/at）を表す。s は Specification、d は Design を表す。
- `<term>` は対象単位を表す識別子（例：`inventory`, `product-register`）とする。
- 文書IDの prefix は小文字（ut/it/...）を用い、表示上の略称は大文字（UT/IT/...）を用いてよい。

### 3.3. テストレベル別 責務一覧

| テストレベル       | 対象（何を確認）                                    | 境界（どこまで含める）                              | 重点（落とし穴）                                                       | 成果物（ID）                                         |
| ------------------ | --------------------------------------------------- | --------------------------------------------------- | ---------------------------------------------------------------------- | ---------------------------------------------------- |
| **単体（UT）**     | ドメインロジック／計算／分岐／バリデーション        | DB・外部I/F・時刻等はモック／スタブで切る           | 境界値／異常値／状態分岐／業務ルール整合                               | `uts-index`, `uts-<term>`, `utd-index`, `utd-<term>` |
| **内部結合（IT）** | コンポーネント間／サービス間の連携                  | 内部は実接続を増やす。外部I/Fは原則隔離（スタブ等） | I/F整合、データ受け渡し、連携例外、状態整合                            | `its-index`, `its-<term>`, `itd-index`, `itd-<term>` |
| **外部結合（ET）** | 外部API／外部ファイル／外部メッセージ               | サンドボックス／スタブ／契約テストで環境差を吸収    | 契約（スキーマ・コード値）、認証、タイムアウト／リトライ、再送／冪等性 | `ets-index`, `ets-<term>`, `etd-index`, `etd-<term>` |
| **総合（ST）**     | システム全体／主要業務フロー／横断要件の成立        | 結合済み環境前提（内部・外部I/F含む構成を基本）     | E2E成立、主要例外、データ整合、運用成立（必要範囲）                    | `sts-index`, `sts-<term>`, `std-index`, `std-<term>` |
| **受入（AT）**     | 受入条件（SAC/BAC）の合否（利用者が判断可能な粒度） | 実装詳細は見ない（期待結果は利用者観点に限定）      | 合否判定の明確さ、証跡、運用シナリオ成立                               | `ats-index`, `ats-<term>`, `atd-index`, `atd-<term>` |

※ 本プロジェクトでは Internal Integration を IT と表記

### 3.4. 補足（用語）

- テストケースは **観点(TP) × 条件(TC)** の組み合わせで構成する
- 「ケース構成」は独立要素ではなく、観点と条件の**組み合わせ方針**を指す

<details>
<summary>参考: テストレベル別 詳細責務 (Informative)</summary>

### 3.5. 共通（詳細）

1. **テスト戦略・方針** (TSP: Test Strategy / Policy; `tsp-overview`)
   - テスト全体の目的、基本方針、役割分担を定義する
   - 「どのテストレベルで、何を、どこまで担保するか」を明確にする（単体／結合／総合／受入の責務境界）
   - 品質ゲート（入口条件・出口条件）を定義する
   - テスト環境、テストデータ、テスト自動化、不具合管理など **テスト運用の前提条件** を整理する\
     ※ 個別の観点・条件・テスト内容は記載しない
2. **テスト観点・条件** (TPC: Test Perspectives & Conditions; `tpc-<term>`)
   - 確認すべき **テスト観点（What）** と **テスト条件（When / State）** を網羅的に整理する
   - 上位仕様（要件・業務仕様・受入条件等）との **トレーサビリティの起点** となる
   - この段階では、単体／結合などのテストレベルには落とし込まない
   - テストケースや具体値は定義しない

### 3.6. 単体テスト(詳細)

1. **単体テスト仕様 全体構成** (UTS Index: Unit Test Specification Index; `uts-index`)
   - TPC で整理された観点・条件を **「単体テストの責務としてどう解釈し、どう分配するか」** を定義する
   - 単体テストにおける以下の **共通前提**を明確にする
     - テスト対象の粒度（対象単位）
     - 単体テストとしての境界（モック／スタブの考え方）
     - 共通の合格基準（単体レベル）
   - 個別単体テスト仕様（`uts-<term>`）への **ナビゲーション（入口）** となる\
     ※ 個別ロジックの詳細条件やテストケースは記載しない
2. **単体テスト仕様 個別仕様** (UTS: Unit Test Specification; `uts-<term>`)
   - 特定の対象単位について、TPC の観点・条件を **単体テストとしてどこまで担保するか** を定義する
   - 単体テストの以下を対象単位ごとに明確化する
     - テスト対象と境界
     - 保証範囲（テスト観点）
     - 代表的なテスト条件（状態レベル）
     - 個別の合格基準（単体レベル）
   - テストケースの列挙や具体値の定義は行わず、テスト設計（UTD）に委ねる
3. **単体テスト設計 全体構成** (UTD Index: Unit Test Design Index; `utd-index`)
   - 単体テスト仕様 全体構成（UTS Index）で定義された前提（境界・対象単位・合格基準）を前提にする
   - 単体テスト設計における **共通の考え方**を整理する
     - テスト観点（TP）とテスト条件（TC）の組み合わせ方針
     - 観点 × 条件 による **ケース構成の基本ルール**
   - テストコード（JUnit 等）を **迷いなく実装・レビューできる状態** を作るための共通指針を定義する
4. **単体テスト設計 個別設計** (UTD: Unit Test Design; `utd-<term>`)
   - 対応する単体テスト仕様（UTS）を前提に、個別対象単位のテスト設計を行う
   - テスト観点（TP）とテスト条件（TC）を組み合わせ、**テストケースを具体化** する
   - テストケースごとに、具体値・期待結果・実行方法を明確にし、個別のテストコードを実装・レビュー可能な粒度まで落とし込む

### 3.7. 内部結合テスト(詳細)

1. **内部結合テスト仕様 全体構成**　(ITS Index: Internal Integration Test Specification Index; `its-index`)
   - TPC で整理された観点・条件を「内部結合テストの責務として」どう解釈し、どう分配するかを定義する
   - 内部結合テストにおける共通前提を明確にする
     - 対象単位（例：コンポーネント間、サービス間、モジュール間）
     - 境界（モック／スタブ／インメモリ等の扱い）
     - 共通の合格基準（内部結合レベル）
   - 個別内部結合テスト仕様（`its-<term>`）へのナビゲーション（入口）となる
   - 単体では担保しない「連携・I/F整合・データ受け渡し」の観点を、内部結合の責務として明確化する
2. **内部結合テスト仕様 個別仕様**
   (ITS: Internal Integration Test Specification; `its-<term>`)
   - 特定の連携対象（例：注文API×在庫、会計×売上集計 等）について、TPC の観点・条件を内部結合としてどこまで担保するかを定義する
   - 内部結合テストの以下を対象単位ごとに明確化する
     - 対象と境界（どこまで実接続し、どこをモックするか）
     - 保証範囲（連携観点：I/F整合、状態遷移、データ整合、例外連携）
     - 代表的なテスト条件（状態・データ・タイミング）
     - 個別の合格基準（内部結合レベル）
   - テストケースの列挙や具体値の定義は行わず、テスト設計（ITD）に委ねる
3. **内部結合テスト設計 全体構成**
   (ITD Index: Internal Integration Test Design Index; `itd-index`)
   - ITS Index で定義された前提（対象単位・境界・共通合格基準）を前提にする
   - 内部結合テスト設計における共通の考え方を整理する
     - テスト観点（TP）とテスト条件（TC）の組み合わせ方針
     - 観点 × 条件 によるケース構成の基本ルール
     - データ準備・状態準備・シナリオ分割の指針
   - 自動化実行・環境依存の扱い（インメモリDB、テストコンテナ等）を「設計として」標準化する
4. **内部結合テスト設計 個別設計**
   (ITD: Internal Integration Test Design; `itd-<term>`)
   - 対応する内部結合テスト仕様（ITS）を前提に、個別対象のテスト設計を行う
   - テスト観点（TP）とテスト条件（TC）を組み合わせ、テストケースを具体化する
   - ケースごとに、前提データ、操作（入力）、期待結果（出力・状態・副作用）を明確にし、実行可能な粒度まで落とし込む
   - 失敗時の切り分けが可能な粒度（どの連携が壊れたか）になるようケース構成を設計する

### 3.8. 外部結合テスト(詳細)

1. **外部結合テスト仕様 全体構成**　(ETS Index: External Integration Test Specification Index; `ets-index`)
   - TPC の観点・条件を「外部結合テストの責務として」どう解釈し、どう分配するかを定義する
   - 外部結合テストにおける共通前提を明確にする
     - 対象単位（外部API／外部ファイル／外部メッセージ等）
     - 境界（サンドボックス／スタブ／契約テスト等の扱い）
     - 共通の合格基準（外部結合レベル）
   - 個別外部結合テスト仕様（`ets-<term>`）へのナビゲーション（入口）となる
   - 単体・内部結合では担保しない「外部契約・疎通・フォーマット・再送／冪等性」を外部結合の責務として明確化する

2. **外部結合テスト仕様 個別仕様**　(ETS: External Integration Test Specification; `ets-<term>`)
   - 特定の外部I/F（外部API、外部ファイル、外部メッセージ）について、外部結合としてどこまで担保するかを定義する
   - 外部結合テストの以下を対象ごとに明確化する
     - 対象と境界（実接続／サンドボックス／スタブ）
     - 保証範囲（契約、認証、フォーマット、エラーハンドリング、タイムアウト、リトライ等）
     - 代表的なテスト条件（データ・異常・タイミング）
     - 個別の合格基準（外部結合レベル）

   - テストケースの列挙や具体値の定義は行わず、テスト設計（ETD）に委ねる

3. **外部結合テスト設計 全体構成**　(ETD Index: External Integration Test Design Index; `etd-index`)
   - ETS Index で定義された前提（対象単位・境界・共通合格基準）を前提にする
   - 外部結合テスト設計における共通の考え方を整理する
     - テスト観点（TP）とテスト条件（TC）の組み合わせ方針
     - 観点 × 条件 によるケース構成の基本ルール
     - 契約確認（スキーマ、必須項目、型、コード値）と差分検知の指針

   - 環境差・外部都合（制限、レート、メンテ）を吸収する設計指針（スタブ、記録再生等）を定義する

4. **外部結合テスト設計 個別設計**　(ETD: External Integration Test Design; `etd-<term>`)
   - 対応する外部結合テスト仕様（ETS）を前提に、個別対象のテスト設計を行う
   - テスト観点（TP）とテスト条件（TC）を組み合わせ、テストケースを具体化する
   - ケースごとに、入力（リクエスト／ファイル内容／メッセージ）、期待結果（応答、状態、通知、副作用）を明確にする
   - 異常系（タイムアウト、再送、重複、部分失敗）で「仕様通りの復旧・通知・再実行可否」が判断できる粒度まで落とし込む

### 3.9. 総合テスト(詳細)

1. **総合テスト仕様 全体構成**　(STS Index: System Test Specification Index; `sts-index`)
   - TPC の観点・条件を「総合テストの責務として」どう解釈し、どう分配するかを定義する
   - 総合テストにおける共通前提を明確にする
     - 対象単位（システム全体、主要業務フロー、重要画面／帳票）
     - 環境前提（結合済み環境、外部I/F接続前提など）
     - 共通の合格基準（総合レベル）
   - 個別総合テスト仕様（`sts-<term>`）へのナビゲーション（入口）となる
   - 単体・結合では担保しない「業務フローの成立」「横断要件（性能・運用・監査等の一部）」を総合の責務として明確化する

2. **総合テスト仕様 個別仕様**　(STS: System Test Specification; `sts-<term>`)
   - 特定の業務フロー／ユースケース群について、総合テストとしてどこまで担保するかを定義する
   - 総合テストの以下を対象ごとに明確化する
     - 対象と前提（利用者役割、システム構成、外部I/F前提）
     - 保証範囲（業務フロー成立、エンドツーエンドの整合、主要例外）
     - 代表的なテスト条件（シナリオの分岐条件、データ状態）
     - 個別の合格基準（総合レベル）

   - 具体的な操作手順の逐語列挙や、ケースの詳細展開はテスト設計（STD）に委ねる

3. **総合テスト設計 全体構成**　(STD Index: System Test Design Index; `std-index`)
   - STS Index の前提（対象・共通合格基準）を前提にする
   - 総合テスト設計における共通の考え方を整理する
     - テスト観点（TP）とテスト条件（TC）の組み合わせ方針
     - 観点 × 条件 によるケース構成の基本ルール
     - シナリオ分割、データ準備、ロール（権限）設計の指針

   - 実行計画（実施順序、データリセット、並行実施可否）を「設計として」標準化する

4. **総合テスト設計 個別設計**　(STD: System Test Design; `std-<term>`)
   - 対応する総合テスト仕様（STS）を前提に、個別対象のテスト設計を行う
   - テスト観点（TP）とテスト条件（TC）を組み合わせ、シナリオ／ケースを具体化する
   - ケースごとに、前提データ、操作（ユーザ操作やAPI呼び出し等の要点）、期待結果（画面、帳票、状態、外部連携）を明確にする
   - 重要シナリオは、障害時の復旧・再実行可否・監査ログ等まで確認できる粒度に落とし込む

### 3.10. 受入テスト(詳細)

1. **受入テスト仕様 全体構成**　(ATS Index: Acceptance Test Specification Index; `ats-index`)
   - TPC の観点・条件を「受入テストの責務として」どう解釈し、どう分配するかを定義する
   - 受入テストにおける共通前提を明確にする
     - 対象単位（受入条件、重要業務フロー、利用者視点の検証範囲）
     - 実施体制（利用者・運用担当の関与、判定責任）
     - 共通の合格基準（受入レベル）

   - 個別受入テスト仕様（`ats-<term>`）へのナビゲーション（入口）となる
   - 「利用者が合格と判断できること」を中心に、総合テストとの差（観点の粒度・判定主体）を明確化する

2. **受入テスト仕様 個別仕様**　(ATS: Acceptance Test Specification; `ats-<term>`)
   - 特定の受入条件／受入シナリオについて、受入テストとしてどこまで担保するかを定義する
   - 受入テストの以下を対象ごとに明確化する
     - 対象と前提（運用前提、利用者役割、データ前提）
     - 保証範囲（受入条件の充足、運用成立、主要な例外）
     - 代表的なテスト条件（利用者視点の分岐条件）
     - 個別の合格基準（受入レベル）

   - 実装詳細や内部ロジックの確認は行わず、利用者が判定可能な期待結果に限定する

3. **受入テスト設計 全体構成**　(ATD Index: Acceptance Test Design Index; `atd-index`)
   - ATS Index の前提（対象・共通合格基準）を前提にする
   - 受入テスト設計における共通の考え方を整理する
     - テスト観点（TP）とテスト条件（TC）の組み合わせ方針
     - 観点 × 条件 によるケース構成の基本ルール
     - 実施手順の粒度（逐語列挙の可否）、証跡取得の指針

   - 受入判定に必要な証跡（帳票、ログ、画面キャプチャ等）の標準を定義する

4. **受入テスト設計 個別設計**　(ATD: Acceptance Test Design; `atd-<term>`)
   - 対応する受入テスト仕様（ATS）を前提に、個別対象のテスト設計を行う
   - テスト観点（TP）とテスト条件（TC）を組み合わせ、受入シナリオ／ケースを具体化する
   - ケースごとに、前提データ、実施手順（利用者が実施可能な粒度）、期待結果（受入条件に対応）を明確にする
   - 受入判定ができるよう、証跡の取り方と判定方法を明示する

</details>

## 5. 判断に迷ったときのルール

1. **「保証の話か？」**
   - Yes → `<level>s-index` / `<level>s-<term>`（例：`uts-index`, `uts-inventory`）
   - No → 次へ

2. **「網羅性・分類の話か？」**
   - Yes → TPC
   - No → 次へ

3. **「具体値・ケース展開か？」**
   - Yes → `<level>d-index` / `<level>d-<term>`（例：`utd-index`, `utd-inventory`）
   - No → 上位（TSP）を疑う

---

## 6. よくあるアンチパターン

| アンチパターン                                               | 問題点           |
| ------------------------------------------------------------ | ---------------- |
| UTS, ITS, ETS, STS, ATS がケース集になっている               | 設計と仕様の混同 |
| TPC に合格基準が書かれている                                 | 戦略との責務衝突 |
| UTD, ITD, ETD, STD, ATD に保証範囲（What）の説明・根拠がある | 重複・更新漏れ   |
| 同じ表が複数文書に存在                                       | 破綻の温床       |
